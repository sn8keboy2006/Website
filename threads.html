<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Threads</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    /* Stylized soft rectangle for thread titles */
    .thread-bookmark {
      display: inline-block;
      background: #bcd2e8;
      color: #232a35;
      font-weight: 700;
      font-size: 1.08em;
      border-radius: 12px;
      padding: 0.16em 1.4em 0.16em 1em;
      box-shadow: 0 2px 8px rgba(34,45,58,0.10);
      letter-spacing: 0.04em;
      border-left: 6px solid #353c48;
      border-bottom: 2px solid #353c48;
      margin-bottom: 0.7em;
      margin-left: -0.5em;
    }
    .thread-info {
      margin-left: 0;
    }
    .loading-count {
      opacity: 0.5;
    }

    .threads-main {
  margin-top: 2rem;
  }
  </style>
</head>
<body>
  <nav>
    <a href="about.html">About</a>
    <a href="index.html">Manifesto</a>
    <a href="threads.html">Threads</a>
  </nav>
  <main class="threads-main">
    <div class="thread-window">
      <div class="thread-info">
        <span class="thread-bookmark">General/Miscellaneous</span>
        <div class="thread-comments" id="count-general">ðŸ’¬ <span class="loading-count">Loading...</span></div>
        <div class="thread-blurb"></div>
      </div>
      <button class="thread-link-btn" onclick="window.location.href='general-thread.html'">View Thread</button>
    </div>
    <div class="thread-window">
      <div class="thread-info">
        <span class="thread-bookmark">Snake-boy's Posts</span>
        <div class="thread-comments" id="count-snakeboy">ðŸ’¬ <span class="loading-count">Loading...</span></div>
        <div class="thread-blurb">"I had the dream again..."</div>
      </div>
      <button class="thread-link-btn" onclick="window.location.href='snakeboy-thread.html'">View Thread</button>
    </div>
    <div class="thread-window">
      <div class="thread-info">
        <span class="thread-bookmark">IU's Journal</span>
        <div class="thread-comments" id="count-iu">ðŸ’¬ <span class="loading-count">Loading...</span></div>
        <div class="thread-blurb">"Once, I was very excited about this show..."</div>
      </div>
      <button class="thread-link-btn" onclick="window.location.href='iu-thread.html'">View Thread</button>
    </div>
    <div class="thread-window">
      <div class="thread-info">
        <span class="thread-bookmark">Post-Encryption and Erratum</span>
        <div class="thread-comments" id="count-mainphreaker">ðŸ’¬ <span class="loading-count">Loading...</span></div>
        <div class="thread-blurb"></div>
      </div>
      <button class="thread-link-btn" onclick="window.location.href='mainphreaker-thread.html'">View Thread</button>
    </div>
  </main>
  <footer>
    <span class="footer-copy">&copy; 2025 </span>
  </footer>
  
  <script>
    const API_URL = 'https://thread-comments.thread-backend.workers.dev/api';
    
    // Count all comments and replies recursively
    function countAllComments(comments) {
      let total = comments.length;
      comments.forEach(comment => {
        if (comment.replies && comment.replies.length > 0) {
          total += countAllComments(comment.replies);
        }
      });
      return total;
    }
    
    // Load comment count for a specific thread
    async function loadThreadCount(threadName, elementId) {
      try {
        const response = await fetch(`${API_URL}/comments/${threadName}`);
        const data = await response.json();
        const count = countAllComments(data.comments || []);
        document.getElementById(elementId).innerHTML = `ðŸ’¬ ${count} comment${count !== 1 ? 's' : ''}`;
      } catch (error) {
        console.error(`Error loading count for ${threadName}:`, error);
        document.getElementById(elementId).innerHTML = 'ðŸ’¬ 0 comments';
      }
    }
    
    // Load all thread counts
    loadThreadCount('general', 'count-general');
    loadThreadCount('snakeboy', 'count-snakeboy');
    loadThreadCount('iu', 'count-iu');
    loadThreadCount('mainphreaker', 'count-mainphreaker');
  </script>
</body>
</html>
